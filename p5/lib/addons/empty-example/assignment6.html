<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>HCDE 439 Assignment 6</title>

    <link rel="stylesheet" type="text/css" href="style.css">

    <script src="libraries/p5.min.js"></script>
    <script src="libraries/p5.sound.min.js"></script>
    <script src="libraries/p5.serialport.js"></script>
  </head>

  <body>

    <div>
      <h2>Schematic for my circuit!</h2>
      <p>
          <img src="img/schematic.png" width=900>
      </p>
      <p>The circuit was powered using a USB connected to my motherboard. I used an RGB LED with 3 220 Ohm resistors </p>
      <p>and two potentiometers both with 10k Ohm resistors in my circuit. Analog signals were sent from my arduino to</p>
      <p>the cavas where I was able to convert them to coordinates. A signal can also be recieved and it changes the color</p>
      <p>of the RGB LED.</p>
  </div>
  <div>
      <h2>Firmware running the site and the RGB LED!</h2>
          <textarea>
//JAVASCRIPT CODE
var serial; // variable to hold an instance of the serialport library
var portName = 'COM5' //rename to the name of your port
var dataarray = []; //array for signal readings
var x; //variables for coordinates
var y;


function setup() {
  serial = new p5.SerialPort();       // make a new instance of the serialport library
  serial.on('list', printList);       // set a callback function for the serialport list event
  serial.on('connected', serverConnected); // callback for connecting to the server
  serial.on('open', portOpen);        // callback for the port opening
  serial.on('data', serialEvent);     // callback for when new data arrives
  serial.on('error', serialError);    // callback for errors
  serial.on('close', portClose);      // callback for the port closing
  
  serial.list();                      // list the serial ports
  serial.open(portName);              // open a serial port
  createCanvas(500, 500);
  background(100, 100, 100);
}
  
// get the list of ports:
function printList(portList) {
  // portList is an array of serial port names
  for (var i = 0; i < portList.length; i++) {
  // Display the list the console:
    print(i + " " + portList[i]);
  }
}

function serverConnected() {
  print('connected to server.');
}
  
function portOpen() {
  print('the serial port opened.')
}
  
function serialError(err) {
  print('Something went wrong with the serial port. ' + err);
}
  
function portClose() {
  print('The serial port closed.');
}

function serialEvent() {
  if (serial.available()) {
    var datastring = serial.readLine(); // readin some serial
    var newarray; 
    try {
      newarray = JSON.parse(datastring); // can we parse the serial
      } catch(err) {
          //console.log(err);
    }
    if (typeof(newarray) == 'object') {
      dataarray = newarray;
    }
    //maps coordinates for use in canvas
    x = map(dataarray[0], 516, 1023, 0, width);
    y = map(dataarray[1], 516, 1023, 0, height);
    //if coordinates reach the edges of the canvas, send a signal 
    //to the arduino to turn the led red until its moved back
    if (x == width || x == 0 || y == 0 || y == height) {
      serial.write(0);
    } else {
      serial.write(1);
    }
    console.log("got back " + x + " " + y);
  } 
}

//draws small circles around the canvas that emulate a line
function draw() {
  noStroke();
  fill(0);
  ellipse(x, y, 5, 5);
}
        </textarea>
        <textarea>
//HTML CODE
<script src="sketch.js"></script>
<button id="myBtn" type="button">CLEAR</button>

<script>
  const myBtn = document.getElementById("myBtn");
  myBtn.addEventListener("click", function(e) {
    console.log("clicked");
    const context = canvas.getContext('2d');
    context.clearRect(0, 0, canvas.width, canvas.height);
    background(100, 100, 100);
  });
</script>

//ARDUINO CODE
//constants for assigning input and output pins
const int potPinA = A0;     
const int potPinB = A1;
const int redLED = 6;
const int greenLED = 5;
const int blueLED = 3;
//variables to hold the states of the potentiometers
int stateA;       
int stateB;

void setup() {
  Serial.begin(9600);
  //two potentiometer inputs in the analog pins, one RGB LED with
  //3 pins for each type of color.
  pinMode(potPinA, INPUT);
  pinMode(potPinB, INPUT);
  pinMode(redLED, OUTPUT);
  pinMode(greenLED, OUTPUT);
  pinMode(blueLED, OUTPUT);
}

void loop() {
  analogWrite(greenLED, 255);
  if (Serial.available() > 0) {
    int input = Serial.read();
    //if signal received is 0, flash a red light, otherwise show green
    if (!input) {
      analogWrite(greenLED, 0);
      analogWrite(redLED, 255);
    } else {
      analogWrite(redLED, 0);
      analogWrite(greenLED, 255);
    }    
  }
  //send out the analog readings from the potentiometers
  stateA = analogRead(potPinA);
  stateB = analogRead(potPinB);
  Serial.print("[");
  Serial.print(stateA);
  Serial.print(",");
  Serial.print(stateB);
  Serial.println("]");
  delay(50);
}

        </textarea>
        <p>I programmed my arduino to use two potentiometers to emulate and online version of an etch-a-sketch. One knob used changed the x</p>
        <p>coordinates while the other changed the y coordinates. There is also a "CLEAR" button which the user can press to clear any drawings</p>
        <p>currently on the canvas. Lastly, if the user ends up reaching the edge of the canvas with the knobs, the RGB LED will go from green</p>
        <p>to red, signifying that the user must change direction in order to keep drawing. The LED will stay red until the "pen" is moved away from the edge.</p>
        </div>
        <div>
            <h2>Final circuit result!</h2>
            <p>
            <img src="img/circuit.jpg" width="800"> </br>
            <img src="img/circuit_operation.gif" width=800>
            <img src="img/circuit_operation_clear.gif" width=800>
            </p>
            <p>The first gif shows the scenario when the user reaches the edge of the canvas and the LED turns red to notify them.</p>
            <p>The second gif shows the clearing function where users can press the "CLEAR" button and wipe the canvas for more drawings.</p>
        </div>
    <script src="sketch.js"></script>
    <button id="myBtn" type="button">CLEAR</button>

    <script>
      const myBtn = document.getElementById("myBtn");
      myBtn.addEventListener("click", function(e) {
        console.log("clicked");
        const context = canvas.getContext('2d');
        context.clearRect(0, 0, canvas.width, canvas.height);
        background(100, 100, 100);
      });
    </script>
  </body>
  
</html>
